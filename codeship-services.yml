webapp:
  build:
    image: registry.heroku.com/minimylist/web
    dockerfile: Dockerfile
  encrypted_env_file: deployment.env.encrypted
  depends_on:
    - chrome
    - chrome2
    - chrome3
    - chrome4
  environment:
    DJANGO_TEST_PROCESSES: 4
  entrypoint: ["./bin/test.sh"]

chrome:
  image: selenium/node-chrome:3.14.0-gallium
  volumes:
    - /dev/shm:/dev/shm
  depends_on:
    - hub
  environment:
    HUB_HOST: hub
    VNC_NO_PASSWORD: 1

chrome2:
  image: selenium/node-chrome:3.14.0-gallium
  volumes:
    - /dev/shm:/dev/shm
  depends_on:
    - hub
  environment:
    HUB_HOST: hub
    VNC_NO_PASSWORD: 1

chrome3:
  image: selenium/node-chrome:3.14.0-gallium
  volumes:
    - /dev/shm:/dev/shm
  depends_on:
    - hub
  environment:
    HUB_HOST: hub
    VNC_NO_PASSWORD: 1

chrome4:
  image: selenium/node-chrome:3.14.0-gallium
  volumes:
    - /dev/shm:/dev/shm
  depends_on:
    - hub
  environment:
    HUB_HOST: hub
    VNC_NO_PASSWORD: 1

hub:
  image: selenium/hub:3.14.0-gallium
  environment:
    GRID_MAX_SESSION: 1


heroku-dockercfg-generator:
  image: codeship/heroku-dockercfg-generator
  add_docker: true
  encrypted_env_file: deployment.env.encrypted

heroku-deployment:
  image: codeship/heroku-deployment
  encrypted_env_file: deployment.env.encrypted
  volumes:
    - ./:/deploy
  environment:
    HEROKU_APP_NAME: minimylist-acc
